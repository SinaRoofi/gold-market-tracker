"""
ماژول مدیریت تعطیلات رسمی ایران
"""

from datetime import datetime
import jdatetime

# تعطیلات رسمی 1404
IRANIAN_HOLIDAYS_1404 = {
    (1404, 1, 1),   # آغاز نوروز
    (1404, 1, 2),   # عید نوروز
    (1404, 1, 3),   # عید نوروز
    (1404, 1, 4),   # عید نوروز
    (1404, 1, 11),  # عید سعید فطر
    (1404, 1, 12),  # تعطیل به‌مناسبت عید فطر + روز جمهوری اسلامی ایران
    (1404, 1, 13),  # روز طبیعت
    (1404, 2, 4),   # شهادت امام جعفر صادق (ع)
    (1404, 3, 14),  # رحلت امام خمینی (ره)
    (1404, 3, 15),  # قیام ۱۵ خرداد
    (1404, 3, 16),  # عید سعید قربان
    (1404, 3, 24),  # عید سعید غدیر خم
    (1404, 4, 14),  # تاسوعای حسینی
    (1404, 4, 15),  # عاشورای حسینی
    (1404, 5, 23),  # اربعین حسینی
    (1404, 5, 31),  # رحلت پیامبر اسلام (ص) / شهادت امام حسن مجتبی (ع)
    (1404, 6, 2),   # شهادت امام رضا (ع)
    (1404, 6, 10),  # شهادت امام حسن عسکری (ع)
    (1404, 6, 19),  # ولادت پیامبر (ص) / ولادت امام جعفر صادق (ع)
    (1404, 9, 3),   # شهادت حضرت فاطمه زهرا (س)
    (1404, 10, 13), # ولادت امام علی (ع) / روز پدر
    (1404, 10, 27), # مبعث پیامبر اسلام (ص)
    (1404, 11, 15), # ولادت حضرت قائم (عج)
    (1404, 11, 22), # پیروزی انقلاب اسلامی ایران
    (1404, 12, 20), # شهادت امام علی (ع)
    (1404, 12, 29), # روز ملی شدن صنعت نفت ایران
}

# تعطیلات رسمی 1405
IRANIAN_HOLIDAYS_1405 = {
    (1405, 1, 1),
    (1405, 1, 2),
    (1405, 1, 3),
    (1405, 1, 4),
    (1405, 1, 12),
    (1405, 1, 13),
    (1405, 1, 25),
    (1405, 3, 6),
    (1405, 3, 14),
    (1405, 3, 15),
    (1405, 4, 3),
    (1405, 4, 4),
    (1405, 5, 13),
    (1405, 5, 21),
    (1405, 5, 22),
    (1405, 5, 30),
    (1405, 6, 8),
    (1405, 8, 22),
    (1405, 10, 2),
    (1405, 10, 16),
    (1405, 11, 4),
    (1405, 11, 22),
    (1405, 12, 9),
    (1405, 12, 19),
    (1405, 12, 20),
    (1405, 12, 29),
}

# دیکشنری سال‌ها
IRANIAN_HOLIDAYS = {
    1404: IRANIAN_HOLIDAYS_1404,
    1405: IRANIAN_HOLIDAYS_1405,
}


def is_iranian_holiday(date_obj):
    """
    بررسی اینکه آیا تاریخ داده شده تعطیل است یا نه

    Args:
        date_obj: datetime object

    Returns:
        bool: True اگر تعطیل باشد
    """
    # تبدیل به تاریخ شمسی
    jalali_date = jdatetime.date.fromgregorian(
        year=date_obj.year, month=date_obj.month, day=date_obj.day
    )
    date_tuple = (jalali_date.year, jalali_date.month, jalali_date.day)

    # بررسی در لیست تعطیلات رسمی
    holidays = IRANIAN_HOLIDAYS.get(jalali_date.year, set())
    if date_tuple in holidays:
        return True

    # پنج‌شنبه و جمعه تعطیل هستند
    return date_obj.weekday() in (3, 4)  # 0=دوشنبه ... 3=پنج‌شنبه, 4=جمعه


def is_working_day(date_obj):
    """
    بررسی اینکه آیا روز کاری است یا نه

    Args:
        date_obj: datetime object

    Returns:
        bool: True اگر روز کاری باشد
    """
    return not is_iranian_holiday(date_obj)
